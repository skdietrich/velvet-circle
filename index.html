<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0a0a0a">
    <title>Velvet Circle | Elite Lifestyle</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root {
            --gold: #D4AF37;
            --gold-dim: #8a701e;
            --bg-dark: #050505;
            --bg-panel: #121212;
            --border: #222;
            --text-main: #e0e0e0;
            --text-muted: #888;
        }

        /* ─── RESET ─── */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { 
            margin: 0; background: var(--bg-dark); color: var(--text-main);
            font-family: 'Lato', sans-serif; font-size: 16px; height: 100vh; overflow: hidden;
        }
        h1, h2, h3 { font-family: 'Cinzel', serif; margin: 0; font-weight: 400; color: var(--gold); }
        button { cursor: pointer; border: none; font-family: 'Lato', sans-serif; }
        input, select, textarea { font-family: 'Lato', sans-serif; }

        /* ─── UTILS ─── */
        .flex-col { display: flex; flex-direction: column; }
        .flex-center { display: flex; align-items: center; justify-content: center; }
        .text-center { text-align: center; }
        .w-full { width: 100%; }
        .hidden { display: none; }
        
        /* ─── UI COMPONENTS ─── */
        .btn-gold {
            background: linear-gradient(135deg, var(--gold), var(--gold-dim));
            color: #000; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
            padding: 16px; border-radius: 4px; font-size: 14px; margin-top: 20px;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2); transition: 0.2s;
        }
        .btn-gold:active { transform: scale(0.98); }
        .btn-gold:disabled { opacity: 0.5; cursor: not-allowed; }

        .input-group { margin-bottom: 20px; text-align: left; }
        .input-label { display: block; color: var(--text-muted); font-size: 11px; text-transform: uppercase; margin-bottom: 8px; letter-spacing: 1px; }
        .input-field {
            background: #1a1a1a; border: 1px solid #333; color: #fff;
            width: 100%; padding: 14px; border-radius: 4px; font-size: 16px;
        }
        .input-field:focus { border-color: var(--gold); }

        .pill-grid { display: flex; flex-wrap: wrap; gap: 10px; }
        .pill {
            padding: 8px 16px; border: 1px solid #444; border-radius: 20px; 
            font-size: 13px; color: #aaa; cursor: pointer; transition: 0.2s;
        }
        .pill.active { border-color: var(--gold); background: rgba(212, 175, 55, 0.1); color: var(--gold); }

        /* ─── FUNNEL LAYOUT ─── */
        .funnel-bg {
            position: fixed; inset: 0; z-index: 0;
            background: url('https://cdni.pornpics.com/1280/1/86/13388789/13388789_001_c465.jpg') no-repeat center center/cover;
        }
        .funnel-overlay {
            position: fixed; inset: 0; z-index: 1;
            background: linear-gradient(to top, #000 0%, rgba(0,0,0,0.95) 40%, rgba(0,0,0,0.6) 100%);
        }
        .funnel-container {
            position: relative; z-index: 10; height: 100vh; display: flex; flex-direction: column;
            justify-content: center; align-items: center; padding: 20px;
        }
        .funnel-card {
            background: rgba(18, 18, 18, 0.95); backdrop-filter: blur(15px);
            width: 100%; max-width: 450px; padding: 40px 30px; border-radius: 8px;
            border-top: 4px solid var(--gold); box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }
        
        /* ─── DASHBOARD ─── */
        .app-shell { display: flex; height: 100vh; background: #000; }
        .sidebar { width: 260px; border-right: 1px solid var(--border); display: flex; flex-direction: column; }
        .main-content { flex: 1; display: flex; flex-direction: column; position: relative; }
        .profile-header {
            height: 300px; background-size: cover; background-position: center; position: relative;
        }
        .profile-avatar {
            width: 120px; height: 120px; border-radius: 50%; border: 4px solid #000;
            position: absolute; bottom: -60px; left: 20px; object-fit: cover;
        }
        .profile-body { margin-top: 70px; padding: 20px; }

        @media (max-width: 768px) {
            .sidebar { display: none; }
            .funnel-card { padding: 30px 20px; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createClient } = supabase;

        // ─── CONFIGURATION ───
        const SUPABASE_URL = "https://wtbswbokojmzmrehrajj.supabase.co"; 
        const SUPABASE_KEY = "sb_publishable_WCwKS1Du4LePjpVqPLZQzA_dsPFbDbd";
        const client = createClient(SUPABASE_URL, SUPABASE_KEY);

        // ─── OPTIONS DATA ───
        const TYPES = ["Couple (MF)", "Couple (MM)", "Couple (FF)", "Single Female", "Single Male"];
        const INTERESTS = ["Soft Swap", "Full Swap", "Same Room", "Separate Room", "Voyeurism", "Exhibitionism", "Group Fun", "Bi-Curious"];

        function App() {
            const [step, setStep] = useState(0); // 0=Landing, 1=Identity, 2=Interests, 3=Photo, 4=Creds, 5=Dashboard
            const [loading, setLoading] = useState(false);
            const [user, setUser] = useState(null);
            
            // FORM DATA
            const [data, setData] = useState({
                type: '', seeking: '', 
                city: '', tagline: '', 
                interests: [],
                photoFile: null, photoPreview: null,
                username: '', password: ''
            });

            // CHECK LOGIN
            useEffect(() => {
                const saved = localStorage.getItem('vc_user');
                if(saved) {
                    setUser(JSON.parse(saved));
                    setStep(5);
                }
            }, []);

            // ─── HANDLERS ───
            
            const toggleInterest = (tag) => {
                if(data.interests.includes(tag)) setData({...data, interests: data.interests.filter(t=>t!==tag)});
                else setData({...data, interests: [...data.interests, tag]});
            };

            const handlePhotoSelect = (e) => {
                const file = e.target.files[0];
                if(file) {
                    setData({
                        ...data, 
                        photoFile: file, 
                        photoPreview: URL.createObjectURL(file)
                    });
                }
            };

            const handleRegister = async () => {
                setLoading(true);
                try {
                    let photoUrl = null;

                    // 1. UPLOAD PHOTO (Real)
                    if(data.photoFile) {
                        const fileName = `${Date.now()}_${data.username}`;
                        const { data: uploadData, error: uploadError } = await client
                            .storage.from('photos').upload(fileName, data.photoFile);
                        
                        if(uploadError) throw uploadError;
                        
                        const { data: urlData } = client.storage.from('photos').getPublicUrl(fileName);
                        photoUrl = urlData.publicUrl;
                    }

                    // 2. CREATE PROFILE RECORD (Real)
                    const newProfile = {
                        username: data.username,
                        profile_type: data.type,
                        city: data.city,
                        bio: data.tagline,
                        interests: data.interests, // Ensure your DB has a JSON or Text array column for this
                        photos: photoUrl ? [photoUrl] : []
                    };

                    const { error: dbError } = await client.from('profiles').insert([newProfile]);
                    if(dbError) throw dbError;

                    // 3. SAVE SESSION
                    localStorage.setItem('vc_user', JSON.stringify(newProfile));
                    setUser(newProfile);
                    setStep(5); // Go to Dashboard

                } catch (err) {
                    alert("Error: " + err.message);
                } finally {
                    setLoading(false);
                }
            };

            // ─── RENDERERS ───

            // STEP 0: LANDING
            if(step === 0) return (
                <div className="funnel-container">
                    <div className="funnel-bg"></div>
                    <div className="funnel-overlay"></div>
                    <div className="funnel-card text-center">
                        <h1 style={{fontSize:32, marginBottom:10}}>VELVET</h1>
                        <p style={{color:'#aaa', letterSpacing:2, marginBottom:40}}>MEMBERS ONLY COMMUNITY</p>
                        <button className="btn-gold" onClick={()=>setStep(1)}>APPLY FOR MEMBERSHIP</button>
                        <p style={{marginTop:20, fontSize:12, color:'#666'}}>Existing members? <u style={{color:'#fff', cursor:'pointer'}}>Log In</u></p>
                    </div>
                </div>
            );

            // STEP 1: IDENTITY
            if(step === 1) return (
                <div className="funnel-container">
                    <div className="funnel-bg"></div>
                    <div className="funnel-overlay"></div>
                    <div className="funnel-card">
                        <div style={{fontSize:10, color:'var(--gold)', marginBottom:10}}>STEP 1 OF 4</div>
                        <h2>The Basics</h2>
                        <p style={{color:'#888', marginBottom:30}}>Tell us who you are.</p>
                        
                        <div className="input-group">
                            <label className="input-label">I am a...</label>
                            <select className="input-field" onChange={e=>setData({...data, type:e.target.value})}>
                                <option value="">Select Identity</option>
                                {TYPES.map(t=><option key={t}>{t}</option>)}
                            </select>
                        </div>
                        
                        <div className="input-group">
                            <label className="input-label">Primary Location</label>
                            <input className="input-field" placeholder="e.g. Dallas, TX" onChange={e=>setData({...data, city:e.target.value})} />
                        </div>

                        <button className="btn-gold" disabled={!data.type || !data.city} onClick={()=>setStep(2)}>NEXT STEP</button>
                    </div>
                </div>
            );

            // STEP 2: INTERESTS (The "Commercial Depth")
            if(step === 2) return (
                <div className="funnel-container">
                    <div className="funnel-bg"></div>
                    <div className="funnel-overlay"></div>
                    <div className="funnel-card">
                        <div style={{fontSize:10, color:'var(--gold)', marginBottom:10}}>STEP 2 OF 4</div>
                        <h2>Your Desires</h2>
                        <p style={{color:'#888', marginBottom:30}}>What are you looking for?</p>
                        
                        <div className="pill-grid">
                            {INTERESTS.map(tag => (
                                <div key={tag} 
                                     className={`pill ${data.interests.includes(tag)?'active':''}`}
                                     onClick={()=>toggleInterest(tag)}>
                                    {tag}
                                </div>
                            ))}
                        </div>

                        <button className="btn-gold" onClick={()=>setStep(3)}>NEXT STEP</button>
                    </div>
                </div>
            );

            // STEP 3: PHOTO UPLOAD
            if(step === 3) return (
                <div className="funnel-container">
                    <div className="funnel-bg"></div>
                    <div className="funnel-overlay"></div>
                    <div className="funnel-card">
                        <div style={{fontSize:10, color:'var(--gold)', marginBottom:10}}>STEP 3 OF 4</div>
                        <h2>Verification Photo</h2>
                        <p style={{color:'#888', marginBottom:30}}>Upload a profile photo. Face not required for privacy.</p>
                        
                        <div style={{border:'2px dashed #333', borderRadius:8, padding:40, textAlign:'center', marginBottom:20, position:'relative'}}>
                            {data.photoPreview ? (
                                <img src={data.photoPreview} style={{width:'100%', height:200, objectFit:'cover', borderRadius:4}} />
                            ) : (
                                <div style={{color:'#666'}}>
                                    <i className="fas fa-camera" style={{fontSize:30, marginBottom:10}}></i>
                                    <br/>Tap to Select
                                </div>
                            )}
                            <input type="file" accept="image/*" onChange={handlePhotoSelect} 
                                   style={{position:'absolute', inset:0, opacity:0, cursor:'pointer'}} />
                        </div>

                        <div className="input-group">
                            <label className="input-label">Profile Tagline</label>
                            <input className="input-field" placeholder="e.g. Fun couple seeking friends" onChange={e=>setData({...data, tagline:e.target.value})} />
                        </div>

                        <button className="btn-gold" disabled={!data.photoFile} onClick={()=>setStep(4)}>NEXT STEP</button>
                    </div>
                </div>
            );

            // STEP 4: CREDENTIALS (Final Gate)
            if(step === 4) return (
                <div className="funnel-container">
                    <div className="funnel-bg"></div>
                    <div className="funnel-overlay"></div>
                    <div className="funnel-card">
                        <div style={{fontSize:10, color:'var(--gold)', marginBottom:10}}>FINAL STEP</div>
                        <h2>Account Access</h2>
                        <p style={{color:'#888', marginBottom:30}}>Secure your profile.</p>
                        
                        <div className="input-group">
                            <label className="input-label">Username</label>
                            <input className="input-field" onChange={e=>setData({...data, username:e.target.value})} />
                        </div>
                        <div className="input-group">
                            <label className="input-label">Password</label>
                            <input type="password" class="input-field" onChange={e=>setData({...data, password:e.target.value})} />
                        </div>

                        <button className="btn-gold" onClick={handleRegister}>
                            {loading ? <i className="fas fa-spinner fa-spin"></i> : "COMPLETE PROFILE"}
                        </button>
                    </div>
                </div>
            );

            // DASHBOARD (The App)
            if(step === 5 && user) return (
                <div className="app-shell">
                    <div className="sidebar" style={{padding:20, borderRight:'1px solid #333'}}>
                        <h3>VELVET</h3>
                        <div style={{marginTop:40, color:'#aaa'}}>
                            <div style={{padding:10, color:'var(--gold)'}}>Home</div>
                            <div style={{padding:10}}>Messages</div>
                            <div style={{padding:10}}>Matches</div>
                            <div style={{padding:10}}>My Profile</div>
                        </div>
                        <button onClick={()=>{localStorage.removeItem('vc_user'); setStep(0);}} style={{marginTop:'auto', color:'#666', background:'none', textAlign:'left'}}>Log Out</button>
                    </div>
                    
                    <div className="main-content">
                        {/* COVER PHOTO (Use funnel bg as cover if no cover uploaded) */}
                        <div className="profile-header" style={{backgroundImage: `url('https://cdni.pornpics.com/1280/1/86/13388789/13388789_001_c465.jpg')`}}>
                            <div style={{position:'absolute', inset:0, background:'linear-gradient(to top, #000, transparent)'}}></div>
                        </div>
                        
                        {/* AVATAR (Use the real uploaded photo) */}
                        <img src={user.photos && user.photos.length > 0 ? user.photos[0] : 'https://via.placeholder.com/150'} className="profile-avatar" />
                        
                        <div className="profile-body">
                            <div style={{display:'flex', justifyContent:'space-between', alignItems:'flex-end'}}>
                                <div>
                                    <h1 style={{fontSize:32, color:'#fff'}}>{user.username}</h1>
                                    <p style={{color:'var(--gold)', fontSize:14}}>{user.profile_type} • {user.city}</p>
                                </div>
                                <button className="btn-gold" style={{width:'auto', padding:'10px 20px', marginTop:0}}>Edit Profile</button>
                            </div>

                            <hr style={{borderColor:'#333', margin:'30px 0'}} />

                            <div style={{display:'grid', gridTemplateColumns:'1fr 2fr', gap:40}}>
                                <div>
                                    <h4 style={{color:'#666', marginBottom:15}}>ABOUT US</h4>
                                    <p style={{color:'#ccc', lineHeight:1.6}}>"{user.bio}"</p>
                                    
                                    <h4 style={{color:'#666', marginTop:30, marginBottom:15}}>INTERESTS</h4>
                                    <div className="pill-grid">
                                        {user.interests && user.interests.map(i => (
                                            <div key={i} style={{border:'1px solid #444', padding:'5px 12px', borderRadius:15, fontSize:12, color:'#888'}}>{i}</div>
                                        ))}
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 style={{color:'#666', marginBottom:15}}>PUBLIC GALLERY</h4>
                                    <div style={{display:'grid', gridTemplateColumns:'repeat(3, 1fr)', gap:10}}>
                                        {user.photos && user.photos.map(p => (
                                            <img src={p} style={{width:'100%', aspectRatio:'1', objectFit:'cover', borderRadius:4}} />
                                        ))}
                                        <div style={{border:'1px dashed #333', borderRadius:4, display:'flex', alignItems:'center', justifyContent:'center', color:'#444', height:150}}>
                                            + Add Photo
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );

            return null;
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
